!function(){window.Admin=Ember.Application.create()}(),function(){AccountUtil={signonWithToken:function(){var a=$.cookie(Vari.TokenName);Util.isEmpty(a)?location.href="#/user/signon":$.ajax({type:"POST",dataType:"json",async:!1,url:Vari.ApiPath+"user/signonWithToken",data:{token:a},success:function(a){a.success?(console.log("success to signonWithToken"),$.cookie(Vari.TokenName,a.data.token),Vari.CurrUser=a.data,location.href.indexOf("apps")>-1?location.reload():location.href="#/apps"):($.removeCookie(Vari.TokenName),location.href="#/user/signon")}})}}}(),function(){CmsUtil={clearContentView:function(){var a=Em.View.views.cms_content_view;a.get("childViews").forEach(function(a){a.remove()}),a.removeAllChildren()},createCmsMenu:function(a){$("#cms-menu").jcarousel({size:a.length,scroll:5,visible:5,itemLoadCallback:function(b){for(var c=b.first;c<=b.last;c++)if(!b.has(c)){if(c>a.length)break;var d=0===a[c-1].status?"forbidden":"";b.add(c,['<li id="jcarousel-item-'+a[c-1].id+'" class="'+d+'" data-id="'+a[c-1].id+'" data-code="'+a[c-1].code+'">','<div class="jcarousel-item-container">','<div><img src="images/icons/white/'+a[c-1].code+'.png" height=30 width=30></div>',"<div>"+a[c-1].title+"</div>","</div>",'<div class="jcarousel-item-move"></div>',"</li>"].join(""))}b.size(a.length)}}),$(".jcarousel-container").delegate("li.jcarousel-item","mouseover",function(){$(this).hasClass("forbidden")||$(this).find(".jcarousel-item-move").css("display","block")}),$(".jcarousel-container").delegate("li.jcarousel-item","mouseout",function(){$(this).hasClass("forbidden")||$(this).find(".jcarousel-item-move").css("display","none")});var b=$("ul.jcarousel-list");b.sortable({items:"li.jcarousel-item",axis:"x",placeholder:"ui-state-highlight",revert:!0,scroll:!0,tolerance:"pointer",cursor:"move",opacity:.9,stop:function(){var a=[];$("ul.jcarousel-list li.jcarousel-item").each(function(){a.push($(this).attr("id").replace("jcarousel-item-",""))});var c=a.join(",");try{$.ajax({type:"GET",dataType:"json",url:Vari.ApiPath+"sub/changeOrder",data:{newIds:c},success:function(){}})}catch(d){console.log(d.name+": "+d.message),b.sortable("cancel")}}}),b.disableSelection()},showCmsNav:function(a){var b=Em.View.views.cms_nav_view;b.set("context",a)},showCmsContent:function(a){CmsUtil.clearContentView();var b=Em.View.views.cms_content_view;b.pushObject(a)}}}(),function(){Code={NotSignon:"NOT_SIGNON"}}(),function(){var toString=Object.prototype.toString,functionType="[object Function]",objectType="[object Object]";Handlebars.registerHelper("vari",function(v){if(Util.isEmpty(v))return"";var value=eval("Vari."+v);return new Handlebars.SafeString(value)}),Handlebars.registerHelper("reqPath",function(a){if(Util.isEmpty(a))return new Handlebars.SafeString(Vari.ApiPath);var b=Vari.ApiPath+a;return new Handlebars.SafeString(b)}),Handlebars.registerHelper("compare",function(a,b,c){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");operator=c.hash.operator||"==",constant=c.hash.constant||!0,a=Ember.get(this,a),"typeof"!==operator&&(constant||(b=Ember.get(this,b)));var d={"==":function(a,b){return a===b},"===":function(a,b){return a===b},"!=":function(a,b){return a!==b},"<":function(a,b){return b>a},">":function(a,b){return a>b},"<=":function(a,b){return b>=a},">=":function(a,b){return a>=b},"typeof":function(a,b){return typeof a===b}};if(!d[operator])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);var e=d[operator](a,b);return e?c.fn(this):c.inverse(this)}),Handlebars.registerHelper("breadcrumb",function(a){a=Ember.get(this,a);for(var b='<ul class="breadcrumb">',c=0;c<a.length;c++){var d=a[c];b+=c===a.length-1?'<li class="active">'+d.label+"</li>":'<li><a href="#">'+d.label+'</a> <span class="divider">/</span></li>'}return b+="</ul>",new Handlebars.SafeString(b)})}(),function(){Custant={ApiVer:"v1"},Custant.WebRoot=location.href.indexOf("192.168")>-1?"http://192.168.1.228:9000/":"http://121.199.18.199/",Vari={ApiPath:Custant.WebRoot+"api/"+Custant.ApiVer+"/",TokenName:"apppress.token",CurrUser:{id:null},CurrApp:null,CurrSub:null,CurrSubId:null,CurrAction:null,DragType:null,srcId:null},Util={isEmpty:function(a){return null===a||"null"===a||void 0===a||"undefined"===a||""===a?!0:!1},isNotEmpty:function(a){return!Util.isEmpty(a)},handleInput:function(){return!1},getUrlParam:function(a){var b="",c=unescape(window.location.href);c=c.split("#")[0];var d=c.split("?")[1];if(!d)return"";for(var e=d.split("&"),f=0;f<e.length;f++){var g=e[f].split("=");if(g[0]===a)return b=g[1]}return b},addHeadLink:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("link");d.setAttribute("rel",a),d.setAttribute("href",b),c.appendChild(d)},removeHeadLink:function(a,b){for(var c=document.getElementsByTagName("link"),d=0;d<c.length;d++)c[d].rel===a&&c[d].href.indexOf(b)>-1&&c[d].parentNode.removeChild(c[d])},getIndexPath:function(){var a=location.href.split("?");delete a[a.length-1];var b=a.join("");return b},getDocSize:function(){var a=window.screen.height;document.body.clientHeight>a&&(a=document.body.clientHeight);var b=window.screen.width;return document.body.clientWidth>b&&(b=document.body.clientWidth),{h:a,w:b}},capFirstLetter:function(a){var b=a.substring(0,1).toUpperCase()+a.substring(1);return b},lowFirstLetter:function(a){var b=a.substring(0,1).toLowerCase()+a.substring(1);return b}}}(),function(){Admin.CmsStoreController=Em.ArrayController.extend({needs:["app","cms"],actions:{createCategory:function(a){var b=this,c=b.store.createRecord("category",{name:"",mstore:a});CmsUtil.clearContentView();var d=Admin.StoreCategoryEditView.create({controller:b,context:c});CmsUtil.showCmsContent(d),CmsUtil.showCmsNav([{label:"categories"},{label:"create"}])},editCategory:function(a){var b=this,c=Admin.StoreCategoryEditView.create({controller:b,context:a});CmsUtil.showCmsContent(c),CmsUtil.showCmsNav([{label:"categories"},{label:"edit"}])},saveCategory:function(a){var b=this,c=$("#categoryEditForm");c.validate(),c.valid()&&(a.one("didCreate",this,function(){b.showContent()}),a.one("didUpdate",this,function(){b.showContent()}),a.save())},deleteCategory:function(a){var b=this;a.get("mstore").get("id"),a.one("didDelete",this,function(){b.showContent()}),b.store.deleteRecord(a),a.save()},showProductList:function(a){this.showProductList(a)},createProduct:function(a){var b=this,c=b.store.createRecord("product",{name:"pp",category:a});CmsUtil.clearContentView();var d=Admin.StoreProductEditView.create({controller:b,context:c});CmsUtil.showCmsContent(d),CmsUtil.showCmsNav([{label:"categories"},{label:"products"},{label:"create"}])},editProduct:function(a){var b=this,c=Admin.StoreProductEditView.create({controller:b,context:a});CmsUtil.showCmsContent(c),CmsUtil.showCmsNav([{label:"categories"},{label:"products"},{label:"edit"}])},saveProduct:function(a){var b=this;jQuery.validator.setDefaults({debug:!0,success:"valid"});var c=$("#productEditForm");if(c.validate(),c.valid()){if(a.get("pictures").get("length")<=0)return alert("Please at lease upload one picture."),void 0;var d="";a.get("pictures").forEach(function(a){Util.isNotEmpty(d)&&(d+=","),d+=a.get("src")}),a.set("pictureStr",d);var e=a.get("category");a.one("didCreate",this,function(){b.showProductList(e)}),a.one("didUpdate",this,function(){b.showProductList(e)}),a.save()}},deleteProduct:function(a){var b=this,c=a.get("category");a.one("didDelete",this,function(){b.showProductList(c)}),b.store.deleteRecord(a),a.save()}},showContent:function(){CmsUtil.clearContentView();var a=this;a.store.find("mstore",{subscriptionId:Vari.CurrSubId}).then(function(b){var c=b.get("content")[0];a.store.find("category",{mstoreId:c.get("id")}).then(function(b){var d=Admin.StoreCategoryListView.create({controller:a,context:{store:c,categories:b}});CmsUtil.showCmsContent(d),CmsUtil.showCmsNav([{label:"categories"}])})})},showProductList:function(a){var b=this;b.store.find("product",{categoryId:a.id}).then(function(c){var d=Admin.StoreProductListView.create({controller:b,context:{category:a,products:c}});CmsUtil.showCmsContent(d),CmsUtil.showCmsNav([{label:"categories"},{label:"products"}])})}})}(),function(){Admin.AppsController=Em.Controller.extend({actions:{createApp:function(){var a=this.store.createRecord("app",{name:"",descr:""});this.transitionToRoute("app.edit",a)},editApp:function(a){this.transitionToRoute("app.edit",a)},modifyApp:function(a){this.transitionToRoute("cms",a)},deleteApp:function(a){a.one("didDelete",this,function(){var a=this.store.find("app");this.set("model",a)}),this.store.deleteRecord(a),a.save()}}}),Admin.AppController=Em.ObjectController.extend({}),Admin.AppEditController=Em.Controller.extend({needs:"app",app:Ember.computed.alias("controllers.app"),actions:{saveApp:function(a){var b=this,c=$("#appEditForm");c.validate(),c.valid()&&(a.one("didCreate",this,function(){b.transitionToRoute("apps")}),a.one("didUpdate",this,function(){b.transitionToRoute("apps")}),a.save())}}})}(),function(){Admin.CmsController=Em.ArrayController.extend({needs:["app","cmsStore"],actions:{},createCmsMenu:function(){var a=this,b=a.get("controllers.app"),c=b.get("content"),d=c.get("id");$.ajax({type:"GET",dataType:"json",url:Vari.ApiPath+"sub/list",data:{appId:d},success:function(b){CmsUtil.createCmsMenu(b),$(".jcarousel-container").delegate("li.jcarousel-item","click",function(){$(this).hasClass("forbidden")||($("li.jcarousel-item").removeClass("active"),$(this).addClass("active"),CmsUtil.clearContentView(),a.showCmsContent($(this).attr("data-id"),$(this).attr("data-code")))})}})},showCmsContent:function(a,b){var c=this;Vari.CurrSubId=a,c.get("controllers.cms"+Util.capFirstLetter(b)).showContent()}})}(),function(){Admin.UserController=Em.ObjectController.extend({signon:function(){var a=this,b=$("#signonForm").validate().form();return b?($("#signonForm").ajaxSubmit(function(b){b.success?(Util.isNotEmpty(b.data.token)?$.cookie(Vari.TokenName,b.data.token):$.removeCookie(Vari.TokenName),Vari.CurrUser=b.data,a.transitionToRoute("apps")):$.removeCookie(Vari.TokenName)}),!1):void 0},guestSignon:function(){var a=this;return $.ajax({async:!1,url:Vari.ApiRestV1+"user/signon",data:{email:"guest@palm.io",password:"pass",rememberMe:"on"},success:function(b){b.success?(Util.isNotEmpty(b.token)?$.cookie(Vari.TokenName,b.token):$.removeCookie(Vari.TokenName),Vari.CurrUser=b.data,a.transitionToRoute("apps")):$.removeCookie(Vari.TokenName)}}),!1},signup:function(){var a=this,b=$("#signupForm").validate({rules:{confirmPassword:{equalTo:"#inputPassword"}}}).form();return b?($(".error").html(""),$(".error").removeClass("error"),$("#signupForm").ajaxSubmit(function(b){b.success?(Util.isNotEmpty(b.token)?$.cookie(Vari.TokenName,b.token):$.removeCookie(Vari.TokenName),Vari.CurrUser=b.data,a.transitionToRoute("apps")):($.removeCookie(Vari.TokenName),alertify.alert('<span class="my-error">'+b.code+"</span>"))}),!1):void 0}})}(),function(){var a=DS.attr;DS.hasMany,DS.belongsTo,Admin.App=DS.Model.extend({name:a(),descr:a(),createTime:a(),updateTime:a(),userId:a()})}(),function(){var a=DS.attr,b=(DS.hasMany,DS.belongsTo);Admin.Category=DS.Model.extend({name:a(),mstore:b("mstore"),didLoad:function(){}})}(),function(){var a=DS.attr;DS.hasMany,DS.belongsTo,Admin.Module=DS.Model.extend({code:a(),name:a(),title:a(),createTime:a(),updateTime:a()})}(),function(){var a=DS.attr;DS.hasMany,DS.belongsTo,Admin.Picture=DS.Model.extend({src:a()})}(),function(){var a=DS.attr,b=DS.hasMany,c=DS.belongsTo;Admin.Product=DS.Model.extend({name:a(),descr:a(),price:a(),freight:a(),flatRate:a(),thumb:a(),order:a(),status:a(),createTime:a(),updateTime:a(),category:c("category"),pictures:b("picture"),pictureStr:a(),didLoad:function(){}})}(),function(){var a=(DS.attr,DS.hasMany,DS.belongsTo);Admin.Mstore=DS.Model.extend({subscription:a("subscription"),didLoad:function(){}})}(),function(){var a=DS.attr,b=(DS.hasMany,DS.belongsTo);Admin.Subscription=DS.Model.extend({code:a(),moduleId:a(),name:a(),title:a(),order:a(),createTime:a(),updateTime:a(),app:b("app"),didLoad:function(){}})}(),function(){var a=DS.attr;DS.hasMany,DS.belongsTo,Admin.User=DS.Model.extend({email:a(),passwd:a(),token:a(),phone:a(),im:a(),status:a(),createTime:a(),updateTime:a()})}(),function(){Admin.AppsView=Em.View.extend({templateName:"app/apps",didInsertElement:function(){},handler:function(){}.observes("controller.content.isLoaded")}),Admin.AppView=Em.View.extend({templateName:"app/main",didInsertElement:function(){}}),Admin.AppEditView=Em.View.extend({templateName:"app/edit",didInsertElement:function(){}})}(),function(){Admin.ApplicationView=Em.View.extend({templateName:"application"})}(),function(){Admin.CmsView=Em.View.extend({templateName:"cms/index",didInsertElement:function(){this.get("controller").createCmsMenu()}}),Admin.CmsPreviewView=Em.View.extend({templateName:"cms/preview",didInsertElement:function(){}})}(),function(){Admin.CmsNavView=Em.View.extend({templateName:"cms/nav"})}(),function(){Admin.FooterView=Em.View.extend({templateName:"footer"})}(),function(){Admin.HeaderView=Em.View.extend({templateName:"header",didInsertElement:function(){}})}(),function(){Admin.StoreCategoryEditView=Em.View.extend({templateName:"store/category/edit",didInsertElement:function(){}})}(),function(){Admin.StoreCategoryListView=Em.View.extend({templateName:"store/category/list",didInsertElement:function(){}})}(),function(){Admin.StoreProductEditView=Em.View.extend({templateName:"store/product/edit",didInsertElement:function(){var a=this;$("#fileupload").fileupload({url:Vari.ApiPath+"upload",dataType:"json",done:function(b,c){var d=c.result.filePath,e=a.get("controller").store.createRecord("picture",{src:d});a.get("context").get("pictures").pushObject(e)},send:function(b,c){return a.get("context").get("pictures").get("length")>=5?(alert("You can only upload 5 pictures."),!1):c.total>1e7?(alert("File size must be less than 10M."),!1):void 0}}),$(".fileinput-preview").delegate(".picture-container","mouseover",function(){$(this).find(".remove").css("display","block")}),$(".fileinput-preview").delegate(".picture-container","mouseout",function(){$(this).find(".remove").css("display","none")}),$(".fileinput-preview").delegate(".picture-container .remove","click",function(){var b=$(this).prev("img").attr("src");console.log(a.get("context").get("pictures").get("length"));var c=-1;a.get("context").get("pictures").forEach(function(a,d){"/"+a.get("src")===b&&(c=d)}),a.get("context").get("pictures").removeAt(c),console.log(a.get("context").get("pictures").get("length")),$(this).parent(".picture-container").remove()})}})}(),function(){Admin.StoreProductListView=Em.View.extend({templateName:"store/product/list",didInsertElement:function(){}})}(),function(){Admin.UserSignonView=Em.View.extend({templateName:"user/signon",didInsertElement:function(){}}),Admin.UserSignupView=Em.View.extend({templateName:"user/signup",didInsertElement:function(){}})}(),function(){Admin.Router.map(function(){this.resource("index",{path:"/"}),this.resource("user",{path:"/user"},function(){this.route("signup",{path:"/signup"}),this.route("signon",{path:"/signon"}),this.route("signout",{path:"/signout"})}),this.resource("apps",{path:"/apps"},function(){}),this.resource("app",{path:"app/:app_id"},function(){this.route("edit",{path:"edit"}),this.resource("cms",{path:"cms"},function(){})})})}(),function(){Admin.AppsRoute=Ember.Route.extend({model:function(){},setupController:function(a){a.store.find("app").then(function(b){a.set("model",b)})}}),Admin.AppRoute=Ember.Route.extend({model:function(a){if(Util.isNotEmpty(a.app_id)){var b=this.store.find("app",a.app_id);return b}},setupController:function(a,b){a.set("model",b)}}),Admin.AppEditRoute=Ember.Route.extend({model:function(){},setupController:function(){}})}(),function(){Admin.ApplicationRoute=Ember.Route.extend({actions:{}})}(),function(){Admin.CmsRoute=Ember.Route.extend({model:function(){},setupController:function(){}})}(),function(){Admin.IndexRoute=Ember.Route.extend({redirect:function(){AccountUtil.signonWithToken()}})}(),function(){Admin.CategoryEditRoute=Ember.Route.extend({model:function(){},setupController:function(){}})}(),function(){Admin.UserRoute=Ember.Route.extend({actions:{signon:function(){this.controller.signon()},signup:function(){this.controller.signup()}}}),Admin.UserSignonRoute=Ember.Route.extend({}),Admin.UserSignupRoute=Ember.Route.extend({}),Admin.UserSignoutRoute=Ember.Route.extend({setupController:function(){var a=this;$.removeCookie(Vari.TokenName),Vari.UserEmail=null,a.transitionTo("user.signon")}})}(),function(){Admin.ApplicationAdapter=DS.RESTAdapter.extend({namespace:"api/v1",host:"http://192.168.1.228:9000"}),Admin.Store=DS.Store.extend(),$.ajaxSetup({statusCode:{555:function(){AccountUtil.signonWithToken()}}}),$.cookie.defaults={expires:7,path:"/",domain:"localhost"}}();